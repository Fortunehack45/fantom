
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is the admin
    function isAdmin() {
      return request.auth != null && request.auth.token.email == 'fortunedomination@gmail.com';
    }

    // Helper function to check if the user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper function to check if the user is the owner of a document
    function isOwner(resource) {
      return isAuthenticated() && request.auth.uid == resource.data.authorId;
    }

    // Blog posts are readable by everyone, but only the admin can create, update, or delete them.
    match /blogPosts/{postId} {
      allow read: if true;
      allow create, update, delete: if isAdmin();

      // Comments on blog posts
      match /comments/{commentId} {
        // Anyone can read comments.
        allow read: if true;
        // Only authenticated users can create comments.
        allow create: if isAuthenticated();
        // Only the author of the comment or an admin can delete it.
        allow delete: if isOwner(resource) || isAdmin();
        // Liking is an update operation. Authenticated users can update likes.
        allow update: if isAuthenticated();

        // Replies to comments
        match /replies/{replyId} {
           // Anyone can read replies.
          allow read: if true;
          // Only authenticated users can create replies.
          allow create: if isAuthenticated();
          // Only the author of the reply or an admin can delete it.
          allow delete: if isOwner(resource) || isAdmin();
          // Liking is an update operation. Authenticated users can update likes.
          allow update: if isAuthenticated();
        }
      }
    }

    // All these collections follow the same rule:
    // Readable by everyone, but writable only by the admin.
    match /(roster|announcements|games|heroImages|timelineEvents|coreValues|galleryImages)/{docId} {
       allow read: if true;
       allow write: if isAdmin();
    }
    
    // Site settings are also readable by everyone, but only writable by the admin.
    match /siteSettings/{docId} {
       allow read: if true;
       allow write: if isAdmin();
    }
  }
}
