
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper functions
    function isAdmin() {
      return request.auth.token.email == 'fortunedomination@gmail.com';
    }
    
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    // Site-wide settings and content (e.g., hero images, games, footer links)
    // Read: Anyone can read.
    // Write: Only the admin can write.
    match /siteSettings/{docId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    match /heroImages/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }
     match /games/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }

    // Page-specific content (e.g., About page)
    // Read: Anyone can read.
    // Write: Only the admin can write.
    match /pageContent/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }
    match /timelineEvents/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }
    match /coreValues/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }
    match /galleryImages/{docId} {
        allow read: if true;
        allow write: if isAdmin();
    }

    // Blog Posts
    // Read: Anyone can read posts.
    // Write: Only the admin can create, update, or delete posts.
    match /blogPosts/{postId} {
      allow read: if true;
      allow write: if isAdmin();
      
      // Comments on Blog Posts
      // Read: Anyone can read comments.
      // Create: Any signed-in user can create a comment.
      // Update: Users can like comments. Only the comment owner can edit their comment content (if functionality is added).
      // Delete: Only the comment owner or an admin can delete a comment.
      match /comments/{commentId} {
        allow read: if true;
        allow create: if isSignedIn();
        allow update: if isSignedIn(); // For liking
        allow delete: if isAdmin() || isOwner(resource.data.authorId);
        
        // Replies to Comments
        // Read: Anyone can read replies.
        // Create: Any signed-in user can create a reply.
        // Update: Users can like replies.
        // Delete: Only the reply owner or an admin can delete a reply.
        match /replies/{replyId} {
            allow read: if true;
            allow create: if isSignedIn();
            allow update: if isSignedIn(); // For liking
            allow delete: if isAdmin() || isOwner(resource.data.authorId);
        }
      }
    }
    
    // Announcements and Roster
    // Read: Anyone can read.
    // Write: Only the admin can write.
    match /announcements/{announcementId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /roster/{memberId} {
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}
