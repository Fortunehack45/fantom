
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is the admin
    function isAdmin() {
      return request.auth.token.email == 'fortunedomination@gmail.com';
    }

    // Helper function to check if the user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper function to check if the user is the owner of a document
    function isOwner(resource) {
      return request.auth.uid == resource.data.authorId;
    }

    // Public collections: readable by anyone, writable only by admin
    match /{collection}/{doc} where collection in ['blogPosts', 'roster', 'announcements', 'games', 'heroImages', 'timelineEvents', 'coreValues', 'galleryImages'] {
      allow read: if true;
      allow write: if isAdmin();

      // Rules for comments and replies on blog posts
      match /comments/{commentId} {
        allow read: if true;
        allow create: if isAuthenticated();
        allow update, delete: if isOwner(resource);

        match /replies/{replyId} {
          allow read: if true;
          allow create: if isAuthenticated();
          allow update, delete: if isOwner(resource);
        }
      }
    }
  }
}
